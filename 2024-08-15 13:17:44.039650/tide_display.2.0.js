offsetYlua=5;var canvasMare=document.getElementById('tina');var ctxMare;var ctxMare=560;var gyMare=160;var fatorMare=5;var sxMare=25;var syMare=300;var syMareMax=55;var sStepMare=3.3;var sfatorMare=2;var baseMarezona=270;var widthMare=570;var baseMarezinha=460;var valorMaxEscalaMare=3;var vMaxMare=100;var offsetVerticalMare=80;var alturaGraficoMarezinha=40;var stepMarezona=8;var stepMarezinha=2.5;var larguraMare=24*stepMarezona;var larguraTabelaMare=120;var larguraMarezinha=24*stepMarezinha;var alturaLegendaMarezinha=16;var alturaLegendaMarezona=25;var alturaHorarioAstrosTabela=80;var alturaHorarioMaresTabela=167;var alturaHorarioAstrosGrafico=80;var alturaBarraTopo=45;var larguraBotaoTopo=85;var alturaBotaoMare=40;var offsetBotoesTopo=5;var alturaMarcadorPicoMare=22;var mudaEscalaMare=false;var yTopoMarezona=0;var alturaMarezona=0;var yTopoMarezinha=0;var alturaMarezinha=0;var yTopoBotoesMare=0;var botaoMareSelecionado=0;var diaFimMares=17;var comprimentoMarezonas=0;var comprimentoTabelaMare=0;var comprimentoMarezinhas=0;var larguraEscala=42;var gxMare=1;var xIniMare=gxMare;var diaQuadrinhoMare=0;var dragMare=0;var mouseDowned=false;var dragging=false;var sobreMare=false;var offsetXmarezinha=0;var offsetXmarezona=0;var offsetXtabelaMare=0;var offsetQuadradinho=15;var largQuadradinho=36;var pontoIniLuaX=0;var pontoIniLuaY=100;var raioLua=10;var fatorMare=0;var sfatorMare=0;var fatorEscalaMare=10;var vStepMare=10;var tipoDisplayMare="grafico";var arrastoOn=false;var numDataInicial="0";var numDiaSemInicial=0;var alturaLegendaTopo=40;var xBotaoRecolheMare=0;var mareRecolhida=false;var larguraBotaoRecolheMare=12;var alturaBotaoRecolheMare=8;var numDiaSemInicial=0;var eDesktop=false;$(function(){window.addEventListener("resize",function(){mudaTipoPrevisaoMare();},false);$("#tina").mousemove(function(event){dragging=true;eDesktop=true;relX_mare=event.pageX-$(this).offset().left;relY_mare=event.pageY-$(this).offset().top;mouseStatus="mousemove";moveMare(relX_mare,relY_mare);});$("#tina").mousedown(function(event){event.preventDefault();relX_mare=event.pageX-$(this).offset().left;relY_mare=event.pageY-$(this).offset().top;mouseStatus="mousedown";centralizado=false;if(!mouseDowned){posIniMareX=relX_mare;posIniMareY=relY_mare;}
mouseDowned=true;dragging=false;});$("#tina").mouseenter(function(event){mouseStatus="mouseenter";});$("#tina").mouseleave(function(event){mouseStatus="mouseleave";mouseDowned=false;dragMare=0;if(arrastoOn)desenhaEscalaLateralMare();});$("#tina").mouseup(function(event){mouseStatus="mouseup";mouseDowned=false;if(!dragging)toqueMare();dragging=false;if(arrastoOn)desenhaEscalaLateralMare();});$("#tina").on("touchmove",function(e){var offsetXmarezinha=0;var dx,dy;e.preventDefault();var changedTouches=e.originalEvent.changedTouches;for(var i=0;i<changedTouches.length;i++){var touch=changedTouches[i];if(touch['target']['id']=="tina"){relX_mare=parseInt(touch.pageX)-$(this).offset().left;relY_mare=parseInt(touch.pageY)-$(this).offset().top;dx=parseInt(posIniMareX-relX_mare);dy=parseInt(posIniMareY-relY_mare);if(dx>2||dx<-2||dy>2||dy<-2){dragging=true;moveMare(relX_mare,relY_mare);}
break;}}});$("#tina").on("touchstart",function(e){e.preventDefault();var changedTouches=e.originalEvent.changedTouches;for(var i=0;i<changedTouches.length;i++){var touch=changedTouches[i];if(touch['target']['id']=="tina"){relX_mare=parseInt(touch.pageX)-$(this).offset().left;relY_mare=parseInt(touch.pageY)-$(this).offset().top;if(!mouseDowned){posIniMareX=relX_mare;posIniMareY=relY_mare;}
mouseDowned=true;dragging=false;break;}}
mouseStatus="mousedown";});$("#tina").on("touchend",function(e){e.preventDefault();mouseStatus="mouseup";mouseDowned=false;if(arrastoOn)desenhaEscalaLateralMare();if(!dragging)toqueMare();dragging=false;});});function mudaTipoPrevisaoMare(t){if(t!=null)tipoDisplayMare=t;ctx_mare.clearRect(0,0,widthMare,500);inicializaGraficoMare();}
function inicializaGraficoMare(){widthMare=$("#area_mares").width();if(widthMare==null)widthMare=640;if(widthMare>650)widthMare=650;if(widthMare<250)widthMare=650;$("#tina").attr("width",widthMare-42);comprimentoMarezonas=larguraMare*maxDias-(widthMare-30);comprimentoTabelaMare=larguraTabelaMare*maxDias-(widthMare-30);comprimentoMarezinhas=larguraMarezinha*maxDias-(widthMare-40);if(comprimentoMarezinhas<0){stepMarezinha=Math.ceil((widthMare-40)/(24*maxDias));larguraMarezinha=24*stepMarezinha;comprimentoMarezinhas=larguraMarezinha*maxDias-(widthMare-40);}
if(maxDias<9){comprimentoMarezonas+=200;comprimentoMarezinhas+=200;comprimentoTabelaMare+=200;}
if(unidadeAltura=='f'){fatorEscalaMare=3.05;valorMaxEscalaMare=Math.ceil(fatorEscalaMare*altMaxMare);}else{fatorEscalaMare=10;if(altMaxMare<10){valorMaxEscalaMare=Math.ceil(10*altMaxMare)/10;}else{valorMaxEscalaMare=Math.ceil(altMaxMare);}}
if(valorMaxEscalaMare<0.5)valorMaxEscalaMare=0.5;if(valorMaxEscalaMare<1){vStepMare=0.25;}else if(valorMaxEscalaMare<2){vStepMare=0.5;}else if(valorMaxEscalaMare<4){vStepMare=1;}else if(valorMaxEscalaMare<8){vStepMare=2;}else{vStepMare=4;}
fatorMare=vMaxMare/(fatorEscalaMare*valorMaxEscalaMare);sfatorMare=0.9*alturaGraficoMarezinha/(fatorEscalaMare*valorMaxEscalaMare);if(maxMares>4)baseMarezinha=385;else baseMarezinha=370;xBotaoRecolheMare=widthMare-75;yTopoMarezona=alturaBarraTopo+alturaLegendaTopo;if(tipoDisplayMare=='grafico'){alturaMarezona=alturaLegendaMarezona+vMaxMare+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua)+offsetQuadradinho+2*alturaMarcadorPicoMare+4;}else{alturaMarezona=alturaLegendaMarezona+vMaxMare+temAstro*alturaHorarioAstrosTabela+2*(raioLua+2*offsetYlua)+offsetQuadradinho+2*alturaMarcadorPicoMare+4;if(maxMares<5)alturaMarezona-=70;}
yTopoMarezinha=yTopoMarezona+alturaMarezona+10;alturaMarezinha=alturaGraficoMarezinha+alturaLegendaMarezinha;yTopoBotoesMare=yTopoMarezinha+alturaGraficoMarezinha+alturaLegendaMarezinha+offsetBotoesTopo;if(tipoDisplayMare=="tabela")desenhaEscalaLateralMare();if(mareRecolhida){$("#tina").attr("height",alturaBarraTopo);$("#mare_escala_esq").attr("height",alturaBarraTopo);$("#area_mares").attr("style","height:"+alturaBarraTopo+"px;");}else{$("#tina").attr("height",yTopoBotoesMare+alturaBotaoMare+10);$("#mare_escala_esq").attr("height",yTopoBotoesMare+alturaBotaoMare+10);$("#area_mares").attr("style","height:"+String(yTopoBotoesMare+alturaBotaoMare+10)+"px;");}
mudaEscalaMare=true;desenhaEscalaMare();desenhaTopoMare();if(tipoDisplayMare=='tabela'){desenhaMarezinhas();desenhaTabelaMare();}else{desenhaMarezinhas();desenhaMarezonas();}
desenhaBotoesMare();}
function desenhaTopoMare(){ctx_mare.fillStyle="#0a2b55";ctx_mare.fillRect(0,0,widthMare,alturaBarraTopo);ctx_mare.font="20px Jockey One";ctx_mare.fillStyle="#fff";if(idioma==0){if(widthMare<300)ctx_mare.fillText("MARÉS",0,alturaBarraTopo/2+5);else ctx_mare.fillText("ALTURA DAS MARÉS",0,alturaBarraTopo/2+5);}else{if(widthMare<300)ctx_mare.fillText("TIDES",0,alturaBarraTopo/2+5);else ctx_mare.fillText("TIDE HEIGHTS",0,alturaBarraTopo/2+5);}
var y=alturaBarraTopo/2+alturaBotaoRecolheMare/2;if(mareRecolhida==0){ctx_mare.beginPath();ctx_mare.moveTo(xBotaoRecolheMare,y);ctx_mare.lineTo(xBotaoRecolheMare+larguraBotaoRecolheMare,y);ctx_mare.lineTo(xBotaoRecolheMare+larguraBotaoRecolheMare/2,y-alturaBotaoRecolheMare);ctx_mare.lineTo(xBotaoRecolheMare,y);ctx_mare.fill();}else{y=y=alturaBarraTopo/2-alturaBotaoRecolheMare/2;ctx_mare.beginPath();ctx_mare.moveTo(xBotaoRecolheMare,y);ctx_mare.lineTo(xBotaoRecolheMare+larguraBotaoRecolheMare,y);ctx_mare.lineTo(xBotaoRecolheMare+larguraBotaoRecolheMare/2,y+alturaBotaoRecolheMare);ctx_mare.lineTo(xBotaoRecolheMare,y);ctx_mare.fill();}
pino(15,alturaBarraTopo+alturaLegendaTopo-25,"#000");var em=estacaoMare.toLowerCase();if(idioma==1&&em.indexOf("porto de")!==-1){em=em.substr(8)+" harbor";}
ctx_mare.fillStyle="#0a2b55";ctx_mare.font="18px Jockey One";ctx_mare.fillText(em,30,alturaBarraTopo+alturaLegendaTopo-15);}
function pino(x,y,cor){ctx_mare.fillStyle=cor;ctx_mare.beginPath();ctx_mare.arc(x,y,7,0,2*Math.PI,false);ctx_mare.fill();ctx_mare.beginPath();ctx_mare.moveTo(x-5,y+5);ctx_mare.lineTo(x,y+12);ctx_mare.lineTo(x+5,y+5);ctx_mare.lineTo(x-5,y+5);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.arc(x,y,3,0,2*Math.PI,false);ctx_mare.fill();}
function desenhaBotoesMare(){var yIni=yTopoBotoesMare;var xi=(widthMare-3*larguraBotaoTopo)/2-21;ctx_mare.font="18px Jockey One";var raioBotoesMare=8;ctx_mare.fillStyle="#eee";if(tipoDisplayMare=="grafico"){ctx_mare.fillStyle="#0a2b55";ctx_mare.lineWidth=0;ctx_mare.beginPath();ctx_mare.moveTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.lineTo(xi+raioBotoesMare,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.quadraticCurveTo(xi,yIni+offsetBotoesTopo+alturaBotaoMare,xi,yIni+offsetBotoesTopo+alturaBotaoMare-raioBotoesMare);ctx_mare.lineTo(xi,yIni+offsetBotoesTopo+raioBotoesMare);ctx_mare.quadraticCurveTo(xi,yIni+offsetBotoesTopo,xi+raioBotoesMare,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.fillText(grfc,xi+larguraBotaoTopo/2-25,yIni+offsetBotoesTopo+alturaBotaoMare/2+5);}else{ctx_mare.fillStyle="#ddd";ctx_mare.beginPath();ctx_mare.moveTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.lineTo(xi+raioBotoesMare,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.quadraticCurveTo(xi,yIni+offsetBotoesTopo+alturaBotaoMare,xi,yIni+offsetBotoesTopo+alturaBotaoMare-raioBotoesMare);ctx_mare.lineTo(xi,yIni+offsetBotoesTopo+raioBotoesMare);ctx_mare.quadraticCurveTo(xi,yIni+offsetBotoesTopo,xi+raioBotoesMare,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.closePath();ctx_mare.fill();ctx_mare.beginPath();ctx_mare.stroke();ctx_mare.fillStyle="#666";ctx_mare.fillText(grfc,xi+larguraBotaoTopo/2-25,yIni+offsetBotoesTopo+alturaBotaoMare/2+5);}
if(tipoDisplayMare=="tabela"){ctx_mare.fillStyle="#0a2b55";ctx_mare.fillRect(xi+larguraBotaoTopo,yIni+offsetBotoesTopo,larguraBotaoTopo,alturaBotaoMare);ctx_mare.fillStyle="#fff";ctx_mare.fillText(tbl,xi+3*larguraBotaoTopo/2-25,yIni+offsetBotoesTopo+alturaBotaoMare/2+5);}else{ctx_mare.fillStyle="#ddd";ctx_mare.fillRect(xi+larguraBotaoTopo,yIni+offsetBotoesTopo,larguraBotaoTopo,alturaBotaoMare);ctx_mare.fillStyle="#666";ctx_mare.fillText(tbl,xi+3*larguraBotaoTopo/2-25,yIni+offsetBotoesTopo+alturaBotaoMare/2+5);}
ctx_mare.fillStyle="#ddd";ctx_mare.beginPath();ctx_mare.moveTo(xi+2*larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.lineTo(xi+3*larguraBotaoTopo-raioBotoesMare,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.quadraticCurveTo(xi+3*larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare,xi+3*larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare-raioBotoesMare);ctx_mare.lineTo(xi+3*larguraBotaoTopo,yIni+offsetBotoesTopo+raioBotoesMare);ctx_mare.quadraticCurveTo(xi+3*larguraBotaoTopo,yIni+offsetBotoesTopo,xi+3*larguraBotaoTopo-raioBotoesMare,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+2*larguraBotaoTopo,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+2*larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.closePath();ctx_mare.fill();ctx_mare.beginPath();ctx_mare.stroke();ctx_mare.fillStyle="#666";ctx_mare.fillText(mnth,xi+5*larguraBotaoTopo/2-25,yIni+offsetBotoesTopo+alturaBotaoMare/2+5);ctx_mare.strokeStyle="#666";ctx_mare.moveTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.stroke();ctx_mare.moveTo(xi+2*larguraBotaoTopo,yIni+offsetBotoesTopo);ctx_mare.lineTo(xi+2*larguraBotaoTopo,yIni+offsetBotoesTopo+alturaBotaoMare);ctx_mare.stroke();}
function toqueMare(){var xDiaToque=parseInt((relX_mare-offsetXmarezona)/larguraMare);if(maxDias<9&&xDiaToque>maxDias-1){window.location.href="https://surfguru.com.br/pro";}
if(relY_mare<=alturaBarraTopo){if(relX_mare>=xBotaoRecolheMare){mareRecolhida=!mareRecolhida;inicializaGraficoMare();}}else if(relY_mare>=yTopoMarezinha-20&&relY_mare<=yTopoMarezinha+alturaMarezinha){on_click_Mare();}else if(relY_mare>=yTopoMarezona&&relY_mare<=yTopoMarezona+alturaMarezona){if(tipoDisplayMare=="grafico"){var xPontoToque=parseInt(relX_mare-offsetXmarezona-xDiaToque*larguraMare);if(xDiaToque<maxDias){if(typeof movimento==="function"){movimento(-xDiaToque);moveImagem(xDiaToque+1);}
desenhaMarezonas(false);marcadorMare(0,xPontoToque,xDiaToque,0,0);}}}else if(relY_mare>=yTopoBotoesMare&&relY_mare<=yTopoBotoesMare+alturaBotaoMare){var xi=(widthMare-3*larguraBotaoTopo)/2-21;if(relX_mare>=xi&&relX_mare<xi+larguraBotaoTopo){tipoDisplayMare='grafico';mudaTipoPrevisaoMare();}else if(relX_mare>=xi+larguraBotaoTopo&&relX_mare<xi+2*larguraBotaoTopo){tipoDisplayMare='tabela'
mudaTipoPrevisaoMare();}else if(relX_mare>=xi+2*larguraBotaoTopo&&relX_mare<xi+3*larguraBotaoTopo){window.location.href="/previsao/mare/"+idEstacaoMare;}}}
function moveMare(x,y){var d=h=0;if(y<=alturaBarraTopo){var xi=widthMare-20;if(relX_mare>=xi){document.body.style.cursor="pointer";}else{document.body.style.cursor="";}}else if(y>=yTopoMarezona&&y<=yTopoMarezona+alturaMarezona){document.body.style.cursor="pointer";if(mouseDowned&&dragging){dx=parseInt(posIniMareX-x);dy=parseInt(posIniMareY-y);posIniMareX=x;posIniMareY=y;if(Math.abs(dy)>10*Math.abs(dx)&&Math.abs(dy)>0.5){if(!eDesktop)desenhaArrastoLateralMare();arrastoOn=true;}else{if(arrastoOn)desenhaEscalaLateralMare();if(tipoDisplayMare=='tabela'){offsetXtabelaMare-=dx;if(offsetXtabelaMare>0)offsetXtabelaMare=0;if(offsetXtabelaMare<-1*comprimentoTabelaMare)offsetXtabelaMare=-1*comprimentoTabelaMare;offsetXmarezinha=offsetXtabelaMare*comprimentoMarezinhas/comprimentoTabelaMare;offsetXmarezona=offsetXtabelaMare*comprimentoMarezonas/comprimentoTabelaMare;}else{offsetXmarezona-=dx;if(offsetXmarezona>0)offsetXmarezona=0;if(offsetXmarezona<-1*comprimentoMarezonas)offsetXmarezona=-1*comprimentoMarezonas;offsetXmarezinha=offsetXmarezona*comprimentoMarezinhas/comprimentoMarezonas;offsetXtabelaMare=offsetXmarezona*comprimentoTabelaMare/comprimentoMarezonas;}
desenhaMarezinhas();if(tipoDisplayMare=='tabela')desenhaTabelaMare();else desenhaMarezonas();xScrollPos=Math.round(-1*offsetXmarezinha*extensao/comprimentoMarezinhas);moveGraficos();}}}else if(y>=yTopoMarezinha-20&&y<=yTopoMarezinha+alturaMarezinha){document.body.style.cursor="pointer";diaClicavelMare=Math.floor((x-offsetXmarezinha)/(24*stepMarezinha));if(mouseDowned&&dragging){dx=parseInt(posIniMareX-x);dy=parseInt(posIniMareY-y);posIniMareX=x;posIniMareY=y;if(Math.abs(dy)>10*Math.abs(dx)&&Math.abs(dy)>0.5){if(!eDesktop)desenhaArrastoLateralMare();arrastoOn=true;}else{if(arrastoOn)desenhaEscalaLateralMare();offsetXmarezinha-=dx;if(offsetXmarezinha>0)offsetXmarezinha=0;else if(offsetXmarezinha<-1*comprimentoMarezinhas)offsetXmarezinha=-1*comprimentoMarezinhas;desenhaMarezinhas();offsetXmarezona=offsetXmarezinha*comprimentoMarezonas/comprimentoMarezinhas;offsetXtabelaMare=offsetXmarezinha*comprimentoTabelaMare/comprimentoMarezinhas;if(tipoDisplayMare=='tabela')desenhaTabelaMare();else desenhaMarezonas();xScrollPos=Math.round(-1*offsetXmarezinha*extensao/comprimentoMarezinhas);moveGraficos();}}}else if(y>=yTopoBotoesMare&&y<=yTopoBotoesMare+alturaBotaoMare){var xi=(widthMare-3*larguraBotaoTopo)/2-21;if(relX_mare>=xi&&relX_mare<xi+3*larguraBotaoTopo){document.body.style.cursor="pointer";}else{document.body.style.cursor="";}}else{document.body.style.cursor="";diaClicavelMare=-1;}
if(mouseStatus=="mouseup"||mouseStatus=="mouseleave"){mouseDowned=false;}}
function desenhaEscalaMare(){var base=yTopoMarezona+vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+ +2*(1-temAstro)*(raioLua+2*offsetYlua);ctx_mare.beginPath();ctx_mare.strokeStyle="#000";ctx_mare.lineWidth=1;ctx_mare.moveTo(offsetXmarezona,base);ctx_mare.lineTo(offsetXmarezona,base-vMaxMare-offsetVerticalMare);ctx_mare.stroke();ctx_mare.beginPath();ctx_mare.strokeStyle="#333";ctx_mare.lineWidth=0.5;for(c=vStepMare;c<=valorMaxEscalaMare;c+=vStepMare){for(b=gxMare-3;b<=widthMare+gxMare+3;b+=6){ctx_mare.moveTo(b,base-c*fatorEscalaMare*fatorMare);ctx_mare.lineTo(b+3,base-c*fatorEscalaMare*fatorMare);}}
ctx_mare.stroke();if(mudaEscalaMare){desenhaEscalaLateralMare();mudaEscalaMare=false;}}
function desenhaEscalaLateralMare(){var cc="";var offtxt=0;var strUnid="m";var ho=alturaHorarioMaresTabela;if(maxMares<5)ho=alturaHorarioMaresTabela/2;arrastoOn=false;ctx_mare_escala_esq.clearRect(0,0,larguraEscala,baseMarezinha+20);if(tipoDisplayMare=="tabela"){ctx_mare_escala_esq.font="11px verdana";ctx_mare_escala_esq.fillStyle="#666";ctx_mare_escala_esq.strokeStyle="#999";ctx_mare_escala_esq.save();ctx_mare_escala_esq.translate(larguraEscala/2,yTopoMarezona+alturaLegendaMarezona+alturaHorarioAstrosTabela+alturaHorarioMaresTabela+2*(raioLua+2*offsetYlua));ctx_mare_escala_esq.rotate(-Math.PI/2);ctx_mare_escala_esq.font="12px verdana";ctx_mare_escala_esq.fillStyle="#333";if(maxMares<5){ctx_mare_escala_esq.fillText(tdsIn,(1-temAstro)*alturaHorarioMaresTabela/2+95,-5);if(unidadeAltura=='f'){ctx_mare_escala_esq.fillText(ft+" (ft)",(1-temAstro)*alturaHorarioMaresTabela/2+105,10);}else{ctx_mare_escala_esq.fillText(mts+" (m)",(1-temAstro)*alturaHorarioMaresTabela/2+92,10);}}else{if(unidadeAltura=='f'){ctx_mare_escala_esq.fillText(tdsIn+" "+ft+" (ft)",(1-temAstro)*alturaHorarioMaresTabela/2+25,5);}else{ctx_mare_escala_esq.fillText(tdsIn+" "+mts+" (m)",(1-temAstro)*alturaHorarioMaresTabela/2+20,5);}}
if(temAstro){if(idioma==0){ctx_mare_escala_esq.fillText("Horas dos",alturaHorarioMaresTabela+50,-5);ctx_mare_escala_esq.fillText("astros",alturaHorarioMaresTabela+60,10);}else{ctx_mare_escala_esq.fillText("moon/sun",alturaHorarioMaresTabela+50,-5);ctx_mare_escala_esq.fillText("Hours",alturaHorarioMaresTabela+60,10);}}
ctx_mare_escala_esq.restore();}else{if(!temAstro){if(temAstro){ctx_mare_escala_esq.beginPath();ctx_mare_escala_esq.moveTo(0,yTopoMarezona+alturaLegendaMarezona+2*(raioLua+2*offsetYlua));ctx_mare_escala_esq.lineTo(larguraEscala,yTopoMarezona+alturaLegendaMarezona+2*(raioLua+2*offsetYlua));ctx_mare_escala_esq.stroke();}}else{ctx_mare_escala_esq.save();ctx_mare_escala_esq.translate(larguraEscala/2,yTopoMarezona+alturaLegendaMarezona+alturaHorarioAstrosTabela+alturaHorarioMaresTabela+2*(raioLua+2*offsetYlua));ctx_mare_escala_esq.rotate(-Math.PI/2);ctx_mare_escala_esq.font="12px verdana";ctx_mare_escala_esq.fillStyle="#333";if(temAstro){if(idioma==0){ctx_mare_escala_esq.fillText("Horas dos",alturaHorarioMaresTabela+50,-5);ctx_mare_escala_esq.fillText("astros",alturaHorarioMaresTabela+60,10);}else{ctx_mare_escala_esq.fillText("moon/sun",alturaHorarioMaresTabela+50,-5);ctx_mare_escala_esq.fillText("Hours",alturaHorarioMaresTabela+60,10);}}
ctx_mare_escala_esq.restore();}
if(unidadeAltura=='f'){strUnid="ft";}
ctx_mare_escala_esq.font="11px verdana";ctx_mare_escala_esq.fillStyle="#666";ctx_mare_escala_esq.strokeStyle="#666";var base=yTopoMarezona+vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua);for(c=0;c<=valorMaxEscalaMare;c+=vStepMare){cc=String(c);if(cc.length==1)offtxt=5;else if(cc.length==2)offtxt=8;else offtxt=10;ctx_mare_escala_esq.lineWidth=0.5;ctx_mare_escala_esq.beginPath();ctx_mare_escala_esq.moveTo(0,base-fatorEscalaMare*c*fatorMare);ctx_mare_escala_esq.lineTo(larguraEscala/2-offtxt-3,base-fatorEscalaMare*c*fatorMare);ctx_mare_escala_esq.stroke();ctx_mare_escala_esq.beginPath();ctx_mare_escala_esq.moveTo(larguraEscala/2+offtxt+3,base-fatorEscalaMare*c*fatorMare);ctx_mare_escala_esq.lineTo(larguraEscala,base-fatorEscalaMare*c*fatorMare);ctx_mare_escala_esq.stroke();ctx_mare_escala_esq.fillText(cc,larguraEscala/2-offtxt,base-fatorEscalaMare*c*fatorMare+3);ctx_mare_escala_esq.fillText(strUnid,larguraEscala/2-7,base-fatorEscalaMare*c*fatorMare+14);}}
ctx_mare_escala_esq.fillStyle="#0a2b55";ctx_mare_escala_esq.fillRect(0,0,larguraEscala,alturaBarraTopo);}
function desenhaArrastoLateralMare(){ctx_mare_escala_esq.clearRect(0,0,larguraEscala,yTopoBotoesMare+alturaBotaoMare+10);ctx_mare_escala_esq.fillStyle="#ccc";ctx_mare_escala_esq.strokeStyle="#333";var sentido=0;for(y=20;y<=baseMarezinha;y+=35){if(y<baseMarezinha/2)sentido=1;else sentido=-1;ctx_mare_escala_esq.beginPath();ctx_mare_escala_esq.moveTo(0,y);ctx_mare_escala_esq.lineTo(larguraEscala/2,y-sentido*15);ctx_mare_escala_esq.lineTo(larguraEscala,y);ctx_mare_escala_esq.lineTo(larguraEscala,y+sentido*15);ctx_mare_escala_esq.lineTo(larguraEscala/2,y);ctx_mare_escala_esq.lineTo(0,y+sentido*15);ctx_mare_escala_esq.lineTo(0,y);ctx_mare_escala_esq.fill();}
ctx_mare_escala_esq.fillStyle="#fff";ctx_mare_escala_esq.fillRect(larguraEscala/2-10,baseMarezinha/2-60,20,120);ctx_mare_escala_esq.save();ctx_mare_escala_esq.translate(larguraEscala/2+10,baseMarezinha/2+40);ctx_mare_escala_esq.rotate(-Math.PI/2);ctx_mare_escala_esq.font="14px verdana";ctx_mare_escala_esq.fillStyle="#333";ctx_mare_escala_esq.fillText("ARRASTE AQUI",-10,-5);ctx_mare_escala_esq.restore();}
function desenhaLuazona(i){var pi=Math.PI;var propRaioIdadeLua=new Array(0,0.1,0.2,0.4,0.7,1.2,2,4);pontoIniLuaY=yTopoMarezona+alturaLegendaMarezona+raioLua+offsetYlua;if(tipoDisplayMare=='grafico'){pontoIniLuaX=offsetXmarezona+(i+0.5)*larguraMare;}else{pontoIniLuaX=offsetXtabelaMare+(i+0.5)*larguraTabelaMare;}
ctx_mare.lineWidth=0.5;var dd=sequenciaIdDias[i];ctx_mare.font="11px Verdana";ctx_mare.font="11px Verdana";var d=Math.floor(dataAtualizacao.substr(4,2))+i;if(idadeLua[dd]>0){if(idadeLua[dd]==1){ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#000";ctx_mare.fillText(nwm,pontoIniLuaX-12,pontoIniLuaY+2*raioLua);}else if(idadeLua[dd]==8){ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,pi/2,3*pi/2,true);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.fill();ctx_mare.fillStyle="#000";ctx_mare.fillText(crcnt,pontoIniLuaX-27,pontoIniLuaY+2*raioLua);}else if(idadeLua[dd]==16){ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.strokeStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.stroke();ctx_mare.fillStyle="#000";ctx_mare.fillText(full,pontoIniLuaX-15,pontoIniLuaY+2*raioLua);}else if(idadeLua[dd]==24){ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,pi/2,true);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.fill();ctx_mare.fillStyle="#000";ctx_mare.fillText(wning,pontoIniLuaX-29,pontoIniLuaY+2*raioLua);}else{if(idadeLua[dd]<=propRaioIdadeLua.length){distRaio=propRaioIdadeLua[idadeLua[dd]-1]*raioLua;teta=Math.atan(raioLua/distRaio);raio=raioLua/Math.sin(teta);ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,pi/2,false);ctx_mare.arc(pontoIniLuaX-distRaio,pontoIniLuaY,raio,teta,-teta,true);ctx_mare.fill();}else if(idadeLua[dd]<=2*propRaioIdadeLua.length){c=2*propRaioIdadeLua.length-idadeLua[dd];distRaio=propRaioIdadeLua[c]*raioLua;teta=Math.atan(raioLua/distRaio);raio=raioLua/Math.sin(teta);ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,pi/2,3*pi/2,true);ctx_mare.arc(pontoIniLuaX+distRaio,pontoIniLuaY,raio,pi-teta,pi+teta,false);ctx_mare.fill();}else if(idadeLua[dd]<=3*propRaioIdadeLua.length){c=idadeLua[dd]-2*propRaioIdadeLua.length;distRaio=propRaioIdadeLua[c]*raioLua;teta=Math.atan(raioLua/distRaio);raio=raioLua/Math.sin(teta);ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,pi/2,true);ctx_mare.arc(pontoIniLuaX-distRaio,pontoIniLuaY,raio,-teta,+teta,false);ctx_mare.fill();}else{c=4*propRaioIdadeLua.length-idadeLua[dd]-1;distRaio=propRaioIdadeLua[c]*raioLua;teta=Math.atan(raioLua/distRaio);raio=raioLua/Math.sin(teta);ctx_mare.fillStyle="#000";ctx_mare.beginPath();ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua+0.5,0,2*pi,false);ctx_mare.fill();ctx_mare.fillStyle="#fff";ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,pi/2,true);ctx_mare.arc(pontoIniLuaX+distRaio,pontoIniLuaY,raio,pi-teta,pi+teta,false);ctx_mare.fill();}}}}
function desenhaMarezinhas(){if(!mareRecolhida){var cm=0;var x=0;var pi=Math.PI;var c,a,h,m,x,y,x0,y0,cx,cy,ang,cm,i,base,d,sd;base=yTopoMarezinha+alturaMarezinha;ctx_mare.clearRect(0,yTopoMarezinha-10,widthMare,alturaGraficoMarezinha+alturaLegendaMarezinha+18);ctx_mare.lineWidth=0.5;ctx_mare.font="10px Verdana";for(i=0;i<maxDias;i++){dd=sequenciaIdDias[i];if(dd==diaSelectMare){ctx_mare.fillStyle="#3f94a0";}else{ctx_mare.fillStyle="#49757b";}
ctx_mare.fillRect(offsetXmarezinha+i*larguraMarezinha,base-alturaGraficoMarezinha,larguraMarezinha,alturaGraficoMarezinha);ctx_mare.fillStyle="#0a2b55";ctx_mare.fillStyle="#ddd";ctx_mare.fillRect(offsetXmarezinha+i*larguraMarezinha,base-alturaGraficoMarezinha-alturaLegendaMarezinha,larguraMarezinha,alturaLegendaMarezinha);if(!isNaN(dd)){ctx_mare.fillStyle="#000";d=diaHoje+i;if(d>diaFim[mesHoje])d-=diaFim[mesHoje];sd=String(d);if(d<10)sd="0"+sd;s=numDiaSemInicial+i;while(s>7)s-=7;while(s<0)s+=7;x=offsetXmarezinha+(i+0.5)*larguraMarezinha-3*(diaSem[s].length+3);ss=diaSem[s].toUpperCase();if(ss=="DOM")x-=2;ctx_mare.fillText(ss+" "+sd,x,base-alturaGraficoMarezinha-alturaLegendaMarezinha+12);}
ctx_mare.beginPath();ctx_mare.strokeStyle="#fff";ctx_mare.moveTo(offsetXmarezinha+i*larguraMarezinha,base);ctx_mare.lineTo(offsetXmarezinha+i*larguraMarezinha,base-alturaGraficoMarezinha-alturaLegendaMarezinha);ctx_mare.stroke();for(c=0;c<maxMares;c++){if(!(typeof(dadosMares[dd])=="undefined"||typeof(dadosMares[dd][c])=="undefined"||dadosMares[dd][c]=="")){cm++;h=Math.floor(dadosMares[dd][c].substr(0,2));m=Math.floor(dadosMares[dd][c].substr(2,2));a=Math.floor(dadosMares[dd][c].substr(4,2));hMedMare=hMedMare+a;x=(h+m/60+24*i)*stepMarezinha;y=sfatorMare*a;if(!(x0==0&&y0==0)){ctx_mare.beginPath();ctx_mare.lineWidth=2;ctx_mare.strokeStyle="#00dfff";ctx_mare.moveTo(offsetXmarezinha+x0,base-y0);for(cx=x0+stepMarezinha/2;cx<=x;cx+=stepMarezinha/2){ang=3.1416*(cx-x0)/(x-x0);cy=(y-y0)*((1+(x0-cx)/(x-x0))+Math.sin(ang));if(y>y0){pp=(1-Math.cos(ang))/2;cy=Math.floor((y-y0)*pp+y0);}
else{pp=(1+Math.cos(ang))/2;cy=Math.floor(y-(y-y0)*pp);}
ctx_mare.lineTo(offsetXmarezinha+cx,base-cy);}
ctx_mare.lineTo(offsetXmarezinha+x,base-y);ctx_mare.stroke();}
x0=x;y0=y;}}}
if((!pro)&&temAstro&&tipoDisplayMare=='grafico')maisPrevisaoMarezinha();}}
function desenhaMarezonas(marcar){if(!mareRecolhida){if(marcar==null)marcar=true;var mareSeca,mareSeca0,dd,c,cx,cy,pp,x,y,h,m,a,yTopo,x0=y0=0;var base=yTopoMarezona+vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua);ctx_mare.strokeStyle="#000";ctx_mare.clearRect(0,yTopoMarezona,widthMare,alturaMarezona);for(i=0;i<maxDias;i++){drawFundoGraficoMare(i);desenhaLuazona(i);}
var a,aa=-10;var cx0=-100;var cc=0;var a1=0;var xl=-100;for(var i=0;i<maxDias;i++){dd=sequenciaIdDias[i];for(c=0;c<maxMares;c++){if(dadosMares[dd]!=undefined&&dadosMares[dd][c]!=undefined&&dadosMares[dd][c]!=""){h=Math.floor(dadosMares[dd][c].substr(0,2));m=Math.floor(dadosMares[dd][c].substr(2,2));a=Math.floor(dadosMares[dd][c].substr(4,2));x=(h+m/60)*stepMarezona+larguraMare*i;y=fatorMare*a;if(!(x0==0&&y0==0)){ctx_mare.beginPath();if(x0>0)ctx_mare.moveTo(offsetXmarezona+x0,base-y0);if(y>y0)ctx_mare.fillStyle="#00dfff";else ctx_mare.fillStyle="#24b2ea";for(cx=x0+stepMarezona/2;cx<=x;cx+=stepMarezona/2){ang=3.1416*(cx-x0)/(x-x0);if(y>y0){pp=(1-Math.cos(ang))/2;cy=Math.floor((y-y0)*pp+y0);}
else{pp=(1+Math.cos(ang))/2;cy=Math.floor(y-(y-y0)*pp);}
if(cx>-3){ctx_mare.lineTo(offsetXmarezona+cx,base-cy);}else{ctx_mare.moveTo(offsetXmarezona-3,base-cy);}}
ctx_mare.lineTo(offsetXmarezona+x,base-y);ctx_mare.lineTo(offsetXmarezona+x,base);if(x0<-3)x0=-3;ctx_mare.lineTo(offsetXmarezona+x0,base);ctx_mare.lineTo(offsetXmarezona+x0,base-y0);ctx_mare.fill();}else{ctx_mare.moveTo(offsetXmarezona+x0,base-y0);}
x0=x;y0=y;}}
for(c=0;c<=maxMares;c++){if(dadosMares[dd]!=undefined&&dadosMares[dd][c]!=undefined&&dadosMares[dd][c]!=""){a=parseInt(dadosMares[dd][c].substr(4,2));if(aa!=a){if(dadosMares[dd]!=undefined&&dadosMares[dd][c+1]!=undefined&&dadosMares[dd][c+1]!=""){a1=parseInt(dadosMares[dd][c+1].substr(4,2));}else if(dadosMares[dd+1]!=undefined&&dadosMares[dd+1][0]!=undefined&&dadosMares[dd+1][0]!=""){a1=parseInt(dadosMares[dd+1][0].substr(4,2));}else{a1=aa;}
aa=a;h=Math.floor(dadosMares[dd][c].substr(0,2));m=Math.floor(dadosMares[dd][c].substr(2,2));xini=gxMare;if(a1>a)mareSeca=alturaMarcadorPicoMare+2;else mareSeca=0;cx=(h+m/60)*stepMarezona-largQuadradinho/2+larguraMare*i+offsetXmarezona;if(cx<=cx0+largQuadradinho&&mareSeca0==mareSeca){if(mareSeca==0){mareSeca=alturaMarcadorPicoMare+2;}else{mareSeca=0;}}
if(y>y0)ctx_mare.strokeStyle="#00dfff";else ctx_mare.strokeStyle="#24b2ea";mareSeca0=mareSeca;cx0=cx;cy=fatorMare*a;hi=Math.floor(h);if(idioma==1){if(hi<12)ap="a";else ap="p";if(hi==0||hi==12)sh="12";else if(hi>12){hi-=12;sh=String(hi);}
else sh=String(hi);}else sh=String(hi);if(hi<10&&hi>0)sh="0"+sh;mm=String(m);if(m<10)mm="0"+m;m=a/10;if(unidadeAltura=='f')m=Math.round(32.8*m)/10;hm=String(m);if(hm.length==1)hm=hm+".0";if(unidadeAltura=='f')strUnid="ft";else strUnid="m";ctx_mare.beginPath();if(mareSeca==0){ctx_mare.fillStyle="#00dfff";}else{ctx_mare.fillStyle="#24b2ea";}
ctx_mare.rect(xini+cx,base+offsetQuadradinho+mareSeca,largQuadradinho,alturaMarcadorPicoMare);ctx_mare.fill();ctx_mare.font="8.5px verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(sh+":"+mm+ap,xini+cx+3,base+offsetQuadradinho+mareSeca+10);ctx_mare.fillText(hm+" "+strUnid,xini+cx+3,base+offsetQuadradinho+mareSeca+20);cc++;}}}
if(temAstro){for(c=0;c<5;c++){if(typeof(dadosAstros[dd])!="undefined"&&typeof(dadosAstros[dd][c])!="undefined"){astro=dadosAstros[dd][c];if(astro.length==5){hi=parseInt(astro.substr(0,2));mm=astro.substr(2,2);hh=String(hi);x=offsetXmarezona+parseInt(stepMarezona*(hi+parseInt(mm)/60))+larguraMare*i;if(idioma==1){if(hi<12)ap="a";else ap="p";if(hi==0||hi==12)sh="12";else if(hi>12){hi-=12;sh=String(hi);}
else sh=String(hi);hora=sh+":"+mm+ap;}else{hora=hh+":"+mm+"h";}
if(hi<10&&hi>0)sh="0"+sh;a1=Number(astro.substr(4,1));ctx_mare.font="10px Verdana";ctx_mare.fillStyle="#000";if(a1<2){h=yTopoMarezona+alturaLegendaMarezona+15;if(a1==0){desenhaAstro(x,h,0);}else{desenhaAstro(x,h,1);}
ctx_mare.fillText(hora,x-15,h+20);}else if(a1<4){h=yTopoMarezona+alturaLegendaMarezona+50;if(xl<x+100){if(a1==2){desenhaAstro(x,h,2);}else{desenhaAstro(x,h,3);}
ctx_mare.fillText(hora,x-15,h+25);}
xl=x;}}}}}}
if(marcar){var dt=new Date();xPontoToque=(dt.getHours()+dt.getMinutes()/60)*stepMarezona;marcadorMare(1,xPontoToque,0);}
desenhaEscalaMare();if(!pro)maisPrevisaoMarezona();}}
function maisPrevisaoMarezona(){var x0=0;if(tipoDisplayMare=='grafico'){x0=offsetXmarezona+8*larguraMare;}else{x0=offsetXtabelaMare+8*larguraTabelaMare;}
var base=yTopoMarezona;ctx_mare.clearRect(x0,base,200,alturaMarezona);ctx_mare.fillStyle="#336";ctx_mare.fillRect(x0+10,base,180,50);ctx_mare.font="bold 15px verdana";ctx_mare.fillStyle="#fff";ctx_mare.fillText(morFcst,x0+20,base+20);ctx_mare.fillText(ahd+" →",x0+70,base+40);ctx_mare.font="bold 12px verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(sgnUp,x0+10,base+80);ctx_mare.fillText(hvAcss,x0+10,base+95);ctx_mare.fillText(extnd,x0+10,base+110);var b=225;if(!(tipoDisplayMare=="tabela"&&!temAstro)){ctx_mare.fillText(sgProAlso,x0+10,base+140);ctx_mare.fillText(alrts,x0+10,base+155);ctx_mare.fillText(byMail,x0+10,base+170);ctx_mare.fillText(cnslt,x0+10,base+185);ctx_mare.fillText(hndCst,x0+10,base+200);}else{b=165;}
ctx_mare.fillStyle="#336";ctx_mare.fillRect(x0+20,base+b,160,30);ctx_mare.font="bold 13px verdana";ctx_mare.fillStyle="#fff";ctx_mare.fillText(clqHr,x0+50,base+b+20);}
function maisPrevisaoMarezinha(){var base=0;base=yTopoMarezinha;ctx_mare.fillStyle="#336";ctx_mare.fillRect(offsetXmarezinha+8*larguraMarezinha+10,yTopoMarezinha,180,alturaGraficoMarezinha+10);ctx_mare.font="bold 15px verdana";ctx_mare.fillStyle="#fff";ctx_mare.fillText(morFcst,offsetXmarezinha+8*larguraMarezinha+20,yTopoMarezinha+22);ctx_mare.fillText(ahd+" →",offsetXmarezinha+8*larguraMarezinha+70,yTopoMarezinha+42);}
function drawFundoGraficoMare(i){var c,a,h,m,x,y,x0,y0,cx,cy,ang,dd=0,d,sd;var alturaMarezona=vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua)+2*alturaMarcadorPicoMare+4;var base=yTopoMarezona+vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua);var alturaGrafico=vMaxMare+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua);x0=offsetXmarezona+i*larguraMare;dia=sequenciaIdDias[i];ctx_mare.fillStyle="#0a2b55";ctx_mare.fillStyle="#ddd";ctx_mare.fillRect(x0,yTopoMarezona,larguraMare-1,alturaLegendaMarezona);d=diaHoje+i;m=mesHoje;if(d>diaFim[m]){d-=diaFim[m];m++;if(m>12)m=1;}
sd=String(d);if(d<10)sd="0"+sd;s=numDiaSemInicial+i-2;while(s>6)s-=7;while(s<0)s+=7;ctx_mare.font="14px Verdana";ctx_mare.fillStyle="#000";ss=nomeDiaSemana[s].toUpperCase();ctx_mare.fillText(ss+" "+sd,x0+12*stepMarezona-4*nomeDiaSemana[s].length-10,yTopoMarezona+18);ctx_mare.font="10px Verdana";ctx_mare.fillStyle="#555";if(idioma==1)ctx_mare.fillText("12a",x0-10,base+10);else ctx_mare.fillText("0h",x0-5,base+10);for(c=3;c<24;c+=3){hi=c;if(idioma==1){if(hi<12)ap="a";else ap="p";if(hi==0||hi==12)hh="12";else if(hi>12)hh=String(hi-12);else hh=String(hi);}else{hh=String(hi);ap="h";}
ctx_mare.fillText(hh+ap,x0+c*stepMarezona-10,base+10);}
horaNascente=6;horaPoente=18;if(temAstro){for(c=0;c<5;c++){if(typeof(dadosAstros[dia])!="undefined"&&typeof(dadosAstros[dia][c])!="undefined"){astro=dadosAstros[dia][c];if(astro.length==5){a1=Number(astro.substr(4,1));if(a1<2){hi=parseInt(astro.substr(0,2));mm=parseInt(astro.substr(2,2));if(a1==0){horaNascente=hi+mm/60;}else{horaPoente=hi+mm/60;}}}}}}
ctx_mare.fillStyle="#eee";ctx_mare.fillStyle="#3f94a0";ctx_mare.fillRect(x0+horaNascente*stepMarezona-1,yTopoMarezona+alturaLegendaMarezona,(horaPoente-horaNascente)*stepMarezona+1,alturaGrafico);ctx_mare.fillStyle="#ddd";ctx_mare.fillStyle="#49757b";ctx_mare.fillRect(x0,yTopoMarezona+alturaLegendaMarezona,horaNascente*stepMarezona-1,alturaGrafico);ctx_mare.fillRect(x0+horaPoente*stepMarezona,yTopoMarezona+alturaLegendaMarezona,(24-horaPoente)*stepMarezona-1,alturaGrafico);}
function desenhaTabelaMare(){var mareSeca,mareSeca0,dd,b,c,cx,cy,pp,x,y,h,m,a,x0=y0=0;var hm=alturaHorarioMaresTabela;if(maxMares<5)hm=alturaHorarioMaresTabela/2;ctx_mare.clearRect(0,yTopoMarezona,widthMare,alturaMarezona+10);var alt=21;var a,aa=-10;var cx0=-100;var a1=0;var xl=-100;for(var i=0;i<maxDias;i++){b=0;var ap="h";var dd=sequenciaIdDias[i];var x0=offsetXtabelaMare+i*larguraTabelaMare;var dia=sequenciaIdDias[i];ctx_mare.fillStyle="#ddd";ctx_mare.fillRect(x0,yTopoMarezona,larguraMare-1,alturaLegendaMarezona);var m=parseInt(mesHoje);var d=parseInt(diaHoje)+i;if(d>diaFim[m]){d-=diaFim[m];m++;if(m>12)m=1;}
var s=numDiaSemInicial+i;while(s>7)s-=7;while(s<1)s+=7;ctx_mare.font="14px Verdana";ctx_mare.fillStyle="#000";ss=diaSem[s].toUpperCase();sd=String(d);if(d<10)sd="0"+sd;ctx_mare.fillText(ss+" "+sd,x0+larguraTabelaMare/2-4*diaSem[s].length-10,yTopoMarezona+alturaLegendaMarezona-8);desenhaLuazona(i);var offsetAstroTabela=18;var alturaAstroTabela=38;if(temAstro){for(c=0;c<5;c++){if(typeof(dadosAstros[dd])!="undefined"&&typeof(dadosAstros[dd][c])!="undefined"){astro=dadosAstros[dd][c];if(astro.length==5){hi=parseInt(astro.substr(0,2));mm=astro.substr(2,2);hh=String(hi);if(idioma==1){if(hi<12)ap="am";else ap="pm";if(hi==0||hi==12)sh="12";else if(hi>12){hi-=12;sh=String(hi);}
else sh=String(hi);hora=sh+":"+mm+ap;}else{hora=hh+":"+mm+"h";}
if(hi<10&&hi>0)sh="0"+sh;a1=Number(astro.substr(4,1));x=i*larguraTabelaMare+offsetXtabelaMare;if(a1<2){if(a1==0){h=yTopoMarezona+alturaLegendaMarezona+offsetAstroTabela+2*(raioLua+1.3*offsetYlua);desenhaAstro(x+larguraTabelaMare/4+5,h,0,"#000");ctx_mare.font="9px Verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(hora,x+larguraTabelaMare/4-15,h+20);}else{h=yTopoMarezona+alturaLegendaMarezona+offsetAstroTabela+2*(raioLua+1.3*offsetYlua);desenhaAstro(x+3*larguraTabelaMare/4-5,h,1,"#000");ctx_mare.font="9px Verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(hora,x+3*larguraTabelaMare/4-20,h+20);}}else if(a1<4){if(a1==2){h=yTopoMarezona+alturaLegendaMarezona+offsetAstroTabela+alturaAstroTabela+2*(raioLua+1.2*offsetYlua);desenhaAstro(x+larguraTabelaMare/4+5,h,2,"#000");ctx_mare.font="9px Verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(hora,x+larguraTabelaMare/4-10,h+25);}else{h=yTopoMarezona+alturaLegendaMarezona+offsetAstroTabela+alturaAstroTabela+2*(raioLua+1.2*offsetYlua);desenhaAstro(x+3*larguraTabelaMare/4-5,h,3,"#000");ctx_mare.font="9px Verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(hora,x+3*larguraTabelaMare/4-20,h+25);}}}}}}
if(idioma==1){offxHoratabela=10;}else{offxHoratabela=0;}
for(c=0;c<=maxMares;c++){if(dadosMares[dd]!=undefined&&dadosMares[dd][c]!=undefined&&dadosMares[dd][c]!=""){a=parseInt(dadosMares[dd][c].substr(4,2));if(aa!=a){if(dadosMares[dd]!=undefined&&dadosMares[dd][c+1]!=undefined&&dadosMares[dd][c+1]!=""){a1=parseInt(dadosMares[dd][c+1].substr(4,2));}else if(dadosMares[dd]!=undefined&&dadosMares[dd][c-1]!=undefined&&dadosMares[dd][c-1]!=""){a1=parseInt(dadosMares[dd][c-1].substr(4,2));}else{a1=aa;}
aa=a;h=Math.floor(dadosMares[dd][c].substr(0,2));m=Math.floor(dadosMares[dd][c].substr(2,2));xini=gxMare;cx=i*larguraTabelaMare+offsetXtabelaMare;if(a1<a)ctx_mare.fillStyle="#00dfff";else ctx_mare.fillStyle="#24b2ea";cy=fatorMare*a;hi=Math.floor(h);if(idioma==1){if(hi<12)ap="am";else ap="pm";if(hi==0||hi==12)sh="12";else if(hi>12){hi-=12;sh=String(hi);}
else sh=String(hi);}else sh=String(hi);if(hi<10&&hi>0)sh="0"+sh;mm=String(m);if(m<10)mm="0"+m;m=a/10;if(unidadeAltura=='f')m=Math.round(32.8*m)/10;hm=String(m);if(hm.length==1)hm=hm+".0";if(unidadeAltura=='f')strUnid="ft";else strUnid="m";ctx_mare.beginPath();y0=yTopoMarezona+alturaLegendaMarezona+temAstro*alturaHorarioAstrosTabela+2*(raioLua+2*offsetYlua)+alt*b;ctx_mare.rect(xini+cx,y0,larguraTabelaMare-2,alt);ctx_mare.fill();ctx_mare.font="12px verdana";ctx_mare.fillStyle="#000";ctx_mare.fillText(sh+":"+mm+ap,xini+cx+10,y0+15);ctx_mare.font="bold 14px verdana";ctx_mare.fillText(hm+" "+strUnid,xini+cx+larguraTabelaMare-60+offxHoratabela,y0+16);b++;}}}
ctx_mare.beginPath();ctx_mare.strokeStyle="#bbb";ctx_mare.moveTo(offsetXtabelaMare+i*larguraTabelaMare,yTopoMarezona);ctx_mare.lineTo(offsetXtabelaMare+i*larguraTabelaMare,yTopoMarezona+alturaMarezona);ctx_mare.stroke();}
if(!pro)maisPrevisaoMarezona();}
function marcadorMare(tipo,xPontoToque,xDiaToque,xa,ma){var c,d,dd,x0,y0,x,y,achou,hora,h,hi,m,a,s,ang,cx;x0=-1000;achou=false;hora=Math.round(10*(xPontoToque-gxMare)/stepMarezona)/10;var base=yTopoMarezona+vMaxMare+alturaLegendaMarezona+temAstro*alturaHorarioAstrosGrafico+2*(1-temAstro)*(raioLua+2*offsetYlua);dd=sequenciaIdDias[xDiaToque];for(c=0;c<maxMares;c++){if(!(typeof(dadosMares[dd])=="undefined"||typeof(dadosMares[dd][c])=="undefined")){h=Math.round(dadosMares[dd][c].substr(0,2));m=Math.round(dadosMares[dd][c].substr(2,2));a=Math.round(dadosMares[dd][c].substr(4,2));if(hora<h+m/60){if(c==0){if(dd==1)break;for(d=0;d<maxMares;d++){if(!(typeof(dadosMares[dd-1])=="undefined"||typeof(dadosMares[dd-1][d])=="undefined")){if(dadosMares[dd-1][d].length>4){s=dadosMares[dd-1][d].substr(0,2);h=Math.round(s);m=Math.round(dadosMares[dd-1][d].substr(2,2));a=Math.round(dadosMares[dd-1][d].substr(4,2));x0=(h+m/60-24)*stepMarezona;y0=fatorMare*a;}}}}else{s=dadosMares[dd][c-1].substr(0,2);h=Math.round(s);m=Math.round(dadosMares[dd][c-1].substr(2,2));a=Math.round(dadosMares[dd][c-1].substr(4,2));x0=(h+m/60)*stepMarezona;y0=fatorMare*a;}
s=dadosMares[dd][c].substr(0,2);h=Math.round(s);m=Math.round(dadosMares[dd][c].substr(2,2));a=Math.round(dadosMares[dd][c].substr(4,2));x=(h+m/60)*stepMarezona;y=fatorMare*a;achou=true;break;}}}
if(!achou){if(dadosMares[dd]!=undefined){for(c=0;c<=maxMares;c++){if(dadosMares[dd][c]==undefined){if(!(dadosMares[dd]==undefined||dadosMares[dd][c-1]==undefined)){h=Math.round(dadosMares[dd][c-1].substr(0,2));m=Math.round(dadosMares[dd][c-1].substr(2,2));a=Math.round(dadosMares[dd][c-1].substr(4,2));x0=(h+m/60)*stepMarezona;y0=fatorMare*a;}
break;}}}
if(!(typeof(dadosMares[dd+1])=="undefined"||typeof(dadosMares[dd+1][0])=="undefined")){h=Math.round(dadosMares[dd+1][0].substr(0,2));m=Math.round(dadosMares[dd+1][0].substr(2,2));a=Math.round(dadosMares[dd+1][0].substr(4,2));x=(24+h+m/60)*stepMarezona;y=fatorMare*a;}}
if(x0>-1000){cx=xPontoToque-1;ang=3.1416*(cx-x0)/(x-x0);if(y>y0){pp=(1-Math.cos(ang))/2;cy=Math.round((y-y0)*pp+y0);}
else{pp=(1+Math.cos(ang))/2;cy=Math.round(y-(y-y0)*pp);}
var baseCaixa=base-cy-50;var baseCaixa2=base-cy-30;if(baseCaixa<0){baseCaixa+=70;baseCaixa2=base-cy;}
ctx_mare.beginPath();ctx_mare.strokeStyle="#f00";ctx_mare.lineWidth=1;for(c=base;c>=baseCaixa2;c-=6){ctx_mare.moveTo(offsetXmarezona+cx+xDiaToque*larguraMare,c);ctx_mare.lineTo(offsetXmarezona+cx+xDiaToque*larguraMare,c-3);}
ctx_mare.stroke();ctx_mare.beginPath();ctx_mare.fillStyle="#af2f5f";ctx_mare.strokeStyle="#fff";if(ang<0.2||ang>3.0||y==y0){ctx_mare.rect(offsetXmarezona+cx-4+xDiaToque*larguraMare,base-cy-4,8,8);}else if(y>y0){ctx_mare.moveTo(offsetXmarezona+cx-4+xDiaToque*larguraMare,base-cy+4);ctx_mare.lineTo(offsetXmarezona+cx+4+xDiaToque*larguraMare,base-cy+4);ctx_mare.lineTo(offsetXmarezona+cx+xDiaToque*larguraMare,base-cy-4);ctx_mare.lineTo(offsetXmarezona+cx-4+xDiaToque*larguraMare,base-cy+4);}else if(y<y0){ctx_mare.moveTo(offsetXmarezona+cx-4+xDiaToque*larguraMare,base-cy-4);ctx_mare.lineTo(offsetXmarezona+cx+4+xDiaToque*larguraMare,base-cy-4);ctx_mare.lineTo(offsetXmarezona+cx+xDiaToque*larguraMare,base-cy+4);ctx_mare.lineTo(offsetXmarezona+cx-4+xDiaToque*larguraMare,base-cy-4);}
ctx_mare.fill();ctx_mare.stroke();ctx_mare.beginPath();ctx_mare.fillStyle="#af2f5f";ctx_mare.rect(offsetXmarezona+cx-largQuadradinho/2+xDiaToque*larguraMare,baseCaixa,largQuadradinho,28);ctx_mare.fill();hi=Math.floor(hora);if(idioma==1){if(hi<12)ap="a";else ap="p";if(hi==0||hi==12)sh="12";else if(hi>12){hi-=12;sh=String(hi);}
else sh=String(hi);}else{sh=String(hi);}
if(hi>23)hi=0;if(hi<10&&hi>0)sh="0"+sh;m=Math.floor((hora-Math.floor(hora))*60);mm=String(m);if(m<10)mm="0"+m;m=Math.round(cy/fatorMare)/10;if(unidadeAltura=='f')m=Math.round(32.8*m)/10;hm=String(m);if(hm.length==1)hm=hm+".0";ctx_mare.beginPath();ctx_mare.font="8.5px verdana";ctx_mare.fillStyle="#fff";strUnid="m";if(unidadeAltura=='f')strUnid="ft";ctx_mare.fillText(sh+":"+mm+ap,offsetXmarezona+cx-largQuadradinho/2+2+xDiaToque*larguraMare,baseCaixa+11);ctx_mare.fillText(hm+" "+strUnid,offsetXmarezona+cx-largQuadradinho/2+2+xDiaToque*larguraMare,baseCaixa+24);ctx_mare.fill();if(tipo==0)diaSelectMare=dd;desenhaMarezinhas();}}
function on_click_Mare(){var diaClicavelMare=Math.floor((relX_mare-offsetXmarezinha)/(24*stepMarezinha));if(diaClicavelMare>-1&&diaClicavelMare<maxDias){var d=sequenciaIdDias[diaClicavelMare];diaSelectMare=d;offsetXmarezona=-1*(larguraMare*diaClicavelMare-(widthMare-larguraMare)/2+30);if(offsetXmarezona>0)offsetXmarezona=0;else if(offsetXmarezona<-1*comprimentoMarezonas)offsetXmarezona=-1*comprimentoMarezonas;offsetXtabelaMare=-1*(larguraTabelaMare*diaClicavelMare-(widthMare-larguraTabelaMare)/2+30);if(offsetXtabelaMare>0)offsetXtabelaMare=0;else if(offsetXtabelaMare<-1*comprimentoTabelaMare)offsetXtabelaMare=-1*comprimentoTabelaMare;if(typeof movimento==="function"){movimento(-diaClicavelMare);moveImagem(diaClicavelMare+1);}else{xScrollPos=Math.round(-1*offsetXmarezona*extensao/comprimentoMarezonas);moveGraficos("mare");}
if(tipoDisplayMare=="grafico"){desenhaMarezonas();}else{desenhaTabelaMare();}
desenhaMarezinhas();}}
function deslocaMare(dd){var d=dd-1;diaSelectMare=dd+1;offsetXmarezona=-1*(larguraMare*d-(widthMare-larguraMare)/2+30);offsetXmarezinha=offsetXmarezona*comprimentoMarezinhas/comprimentoMarezonas;offsetXtabelaMare=offsetXmarezona*comprimentoTabelaMare/comprimentoMarezonas;if(offsetXmarezona>0)offsetXmarezona=0;else if(offsetXmarezona<-1*comprimentoMarezonas)offsetXmarezona=-1*comprimentoMarezonas;offsetXtabelaMare=-1*(larguraTabelaMare*d-(widthMare-larguraTabelaMare)/2+30);if(offsetXtabelaMare>0)offsetXtabelaMare=0;else if(offsetXtabelaMare<-1*comprimentoTabelaMare)offsetXtabelaMare=-1*comprimentoTabelaMare;if(tipoDisplayMare=="grafico"){desenhaMarezonas();}else{desenhaTabelaMare();}
desenhaMarezinhas();}
function desenhaAstro(pontoIniLuaX,pontoIniLuaY,astro,cor){if(cor==null)cor="#fff";var raioLua=6;var pi=Math.PI;ctx_mare.fillStyle=cor;ctx_mare.strokeStyle=cor;ctx_mare.lineWidth=0.5;ctx_mare.beginPath();switch(astro){case 0:ctx_mare.moveTo(pontoIniLuaX+raioLua,pontoIniLuaY);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,0,Math.PI,true);ctx_mare.stroke();ctx_mare.moveTo(pontoIniLuaX-2*raioLua,pontoIniLuaY);ctx_mare.lineTo(pontoIniLuaX+2*raioLua,pontoIniLuaY);ctx_mare.stroke();for(var ang=pi/4;ang<=3*pi/4;ang+=pi/4){ctx_mare.moveTo(pontoIniLuaX-Math.cos(ang)*raioLua,pontoIniLuaY-Math.sin(ang)*raioLua);ctx_mare.lineTo(pontoIniLuaX-Math.cos(ang)*2*raioLua,pontoIniLuaY-Math.sin(ang)*2*raioLua);ctx_mare.stroke();}
ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX-raioLua,pontoIniLuaY+15*raioLua/10);ctx_mare.lineTo(pontoIniLuaX+raioLua,pontoIniLuaY+15*raioLua/10);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY+3*raioLua/8);ctx_mare.lineTo(pontoIniLuaX-raioLua,pontoIniLuaY+15*raioLua/10);ctx_mare.fill();break;case 1:ctx_mare.moveTo(pontoIniLuaX+raioLua,pontoIniLuaY);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,0,pi,true);ctx_mare.stroke();ctx_mare.moveTo(pontoIniLuaX-2*raioLua,pontoIniLuaY);ctx_mare.lineTo(pontoIniLuaX+2*raioLua,pontoIniLuaY);ctx_mare.stroke();for(var ang=pi/4;ang<=3*pi/4;ang+=pi/4){ctx_mare.moveTo(pontoIniLuaX-Math.cos(ang)*raioLua,pontoIniLuaY-Math.sin(ang)*raioLua);ctx_mare.lineTo(pontoIniLuaX-Math.cos(ang)*2*raioLua,pontoIniLuaY-Math.sin(ang)*2*raioLua);ctx_mare.stroke();}
ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX-raioLua,pontoIniLuaY+15*raioLua/40);ctx_mare.lineTo(pontoIniLuaX+raioLua,pontoIniLuaY+15*raioLua/40);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY+12*raioLua/8);ctx_mare.lineTo(pontoIniLuaX-raioLua,pontoIniLuaY+15*raioLua/40);ctx_mare.fill();break;case 2:ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,3*pi/20,true);ctx_mare.stroke();ctx_mare.moveTo(pontoIniLuaX+9*raioLua/10,pontoIniLuaY+8*raioLua/20);ctx_mare.arc(pontoIniLuaX+11*raioLua/8,pontoIniLuaY-raioLua,3*raioLua/2,12*pi/20,pi,false);ctx_mare.stroke();ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX-raioLua,pontoIniLuaY+5*raioLua/2);ctx_mare.lineTo(pontoIniLuaX+raioLua,pontoIniLuaY+5*raioLua/2);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY+11*raioLua/8);ctx_mare.lineTo(pontoIniLuaX-raioLua,pontoIniLuaY+5*raioLua/2);ctx_mare.fill();break;case 3:ctx_mare.moveTo(pontoIniLuaX,pontoIniLuaY-raioLua);ctx_mare.arc(pontoIniLuaX,pontoIniLuaY,raioLua,3*pi/2,3*pi/20,true);ctx_mare.stroke();ctx_mare.moveTo(pontoIniLuaX+9*raioLua/10,pontoIniLuaY+8*raioLua/20);ctx_mare.arc(pontoIniLuaX+11*raioLua/8,pontoIniLuaY-raioLua,3*raioLua/2,12*pi/20,pi,false);ctx_mare.stroke();ctx_mare.beginPath();ctx_mare.moveTo(pontoIniLuaX-raioLua,pontoIniLuaY+11*raioLua/8);ctx_mare.lineTo(pontoIniLuaX+raioLua,pontoIniLuaY+11*raioLua/8);ctx_mare.lineTo(pontoIniLuaX,pontoIniLuaY+19*raioLua/8);ctx_mare.lineTo(pontoIniLuaX-raioLua,pontoIniLuaY+11*raioLua/8);ctx_mare.fill();}}